<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PREP Survey Form</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Outfit:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://cdn.botpress.cloud/webchat/v1/inject.js"></script>
    <script>
        window.botpressWebChat.init({ host: 'https://cdn.botpress.cloud/webchat/v1', botId: 'e8f7a9b0-9b2c-4f1e-8e9c-0a1b2c3d4e5f' });
    </script>
    <style>
        :root {
            --primary: #1e40af;
            --primary-light: #e0f7fa;
            --accent: #3b82f6;
            --accent-gradient: linear-gradient(135deg, #e0f7fa 0%, #bfdbfe 70%, #93c5fd 100%);
            --accent-orange: #f97316;
            --accent-orange-gradient: linear-gradient(135deg, #f97316 0%, #fdba74 100%);
            --dark: #0f172a;
            --light: #f8fafc;
            --lighter: #ffffff;
            --background: linear-gradient(135deg, #e0f2fe 0%, #dbeafe 100%);
            --card-shadow: 0 15px 40px rgba(30, 64, 175, 0.2);
            --hover-shadow: 0 30px 60px rgba(30, 64, 175, 0.3);
            --border-radius: 25px;
            --transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
            --glass-bg: rgba(255, 255, 255, 0.25);
            --glass-border: rgba(255, 255, 255, 0.4);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Outfit', 'Inter', sans-serif; }
        body { background: var(--background); min-height: 100vh; padding: 20px; line-height: 1.6; overflow-x: hidden; position: relative; }
        body.dark-mode { --background: linear-gradient(135deg, #1e293b 0%, #334155 100%); --light: #334155; --lighter: #475569; --card-shadow: 0 15px 40px rgba(0, 0, 0, 0.4); --hover-shadow: 0 30px 60px rgba(0, 0, 0, 0.5); }

        .particles { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: -1; }
        .container { background: var(--lighter); border-radius: var(--border-radius); box-shadow: var(--card-shadow); max-width: 1000px; margin: 0 auto; overflow: hidden; }
        .title-bar { background: var(--accent-gradient); text-align: center; padding: 20px; color: var(--lighter); font-weight: 800; font-size: 2.5rem; text-transform: uppercase; letter-spacing: 2px; text-shadow: 0 2px 5px rgba(0, 0, 0, 0.3); border-bottom: 4px solid var(--accent-orange); }
        .header { background: var(--accent-gradient); color: var(--lighter); padding: 50px; text-align: center; border-bottom: 6px solid var(--glass-border); position: sticky; top: 0; z-index: 1000; backdrop-filter: blur(12px); }
        .header h2 { font-weight: 800; font-size: 3rem; margin-bottom: 20px; text-transform: uppercase; letter-spacing: 2px; text-shadow: 0 3px 6px rgba(0, 0, 0, 0.3); }
        .header p { font-weight: 600; font-size: 1.2rem; opacity: 0.9; }
        .progress-container { width: 100%; background-color: var(--glass-bg); border-radius: 12px; margin: 20px 0; overflow: hidden; height: 12px; position: relative; }
        .progress-bar { height: 100%; background: var(--accent-orange-gradient); border-radius: 12px; width: 0%; transition: width 0.5s ease; animation: progressFill 1s ease-in-out; }
        .progress-text { position: absolute; top: -25px; right: 10px; font-weight: 700; font-size: 1rem; color: var(--lighter); text-shadow: 0 1px 3px rgba(0, 0, 0, 0.2); }
        .hero-slider { position: relative; height: 400px; margin: 30px; border-radius: var(--border-radius); overflow: hidden; box-shadow: var(--card-shadow); border: 3px solid var(--glass-border); background: var(--glass-bg); }
        .hero-slider img { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; opacity: 0; transition: opacity 1s ease; }
        .hero-slider img.active { opacity: 1; }
        .form-container { padding: 60px; background: var(--glass-bg); border-radius: 0 0 var(--border-radius) var(--border-radius); backdrop-filter: blur(12px); }
        .form-group { margin-bottom: 50px; padding: 20px; background: var(--glass-bg); border-radius: 20px; box-shadow: var(--card-shadow); transition: transform 0.4s ease, box-shadow 0.4s ease; animation: slideIn 0.6s ease-out; }
        .form-group:hover { transform: translateY(-5px) scale(1.02); box-shadow: var(--hover-shadow); }
        .form-group.blue { border-left: 5px solid var(--primary); }
        .form-group.orange { border-left: 5px solid var(--accent-orange); }
        .form-group h3 { font-weight: 700; font-size: 1.8rem; color: var(--primary); margin-bottom: 25px; letter-spacing: 0.5px; text-transform: capitalize; position: relative; }
        .image-rotator { position: relative; height: 300px; margin-bottom: 30px; border-radius: 20px; overflow: hidden; box-shadow: var(--card-shadow); border: 3px solid var(--glass-border); background: var(--glass-bg); }
        .image-rotator img { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; opacity: 0; transition: opacity 1s ease; }
        .image-rotator img.active { opacity: 1; }
        .options-container { display: flex; gap: 20px; flex-wrap: wrap; justify-content: center; }
        .option-btn { flex: 1; min-width: 160px; padding: 20px; border: 3px solid var(--glass-border); border-radius: 20px; background: var(--glass-bg); cursor: pointer; transition: var(--transition); text-align: center; font-weight: 600; font-size: 1.1rem; box-shadow: var(--card-shadow); }
        .option-btn:hover { border-color: var(--primary); transform: translateY(-3px) scale(1.03); box-shadow: var(--hover-shadow); }
        .option-btn.selected { background: var(--accent-gradient); color: var(--lighter); border-color: var(--primary); transform: scale(1.03); animation: pulseButton 1.2s infinite; }
        .form-group.orange .option-btn.selected { background: var(--accent-orange-gradient); border-color: var(--accent-orange); }
        .star-rating { display: flex; justify-content: center; gap: 15px; margin: 30px 0; }
        .star { font-size: 2rem; color: #d1d5db; cursor: pointer; transition: color 0.3s ease, transform 0.2s ease; }
        .star:hover, .star.active { color: var(--accent); transform: scale(1.1); animation: twinkle 0.6s ease; }
        textarea, input[type="text"], input[type="email"] { width: 100%; padding: 20px; border: 3px solid var(--glass-border); border-radius: 20px; font-weight: 500; font-size: 1.1rem; transition: var(--transition); background: var(--glass-bg); }
        textarea { resize: vertical; min-height: 180px; }
        .submit-btn-container { display: flex; gap: 30px; flex-wrap: wrap; justify-content: center; margin-top: 30px; padding: 20px; background: var(--glass-bg); border-radius: 20px; box-shadow: var(--card-shadow); position: sticky; bottom: 20px; z-index: 1000; backdrop-filter: blur(12px); }
        .submit-btn { padding: 20px 40px; background: var(--accent-gradient); color: var(--lighter); border: none; border-radius: 50px; font-weight: 800; font-size: 1.3rem; cursor: pointer; transition: var(--transition); box-shadow: var(--hover-shadow); text-transform: uppercase; animation: glow 1.8s infinite; }
        .submit-btn.clear { background: #dc2626; }
        .submit-btn.save { background: #22c55e; }
        .back-to-top { position: fixed; bottom: 30px; right: 30px; background: var(--accent-gradient); color: var(--lighter); width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; text-decoration: none; font-size: 1.5rem; box-shadow: var(--hover-shadow); transition: var(--transition); opacity: 0; visibility: hidden; transform: translateY(20px); }
        .back-to-top.visible { opacity: 1; visibility: visible; transform: translateY(0); animation: bounce 1.5s infinite; }
        .thank-you-message { text-align: center; padding: 60px; background: var(--glass-bg); border-radius: 0 0 var(--border-radius) var(--border-radius); animation: slideUp 0.7s ease-out; backdrop-filter: blur(12px); }
        .cta-button { background: var(--accent-orange-gradient); color: var(--lighter); padding: 15px 30px; border-radius: 50px; font-weight: 700; font-size: 1.1rem; text-decoration: none; transition: var(--transition); box-shadow: var(--hover-shadow); margin: 10px; border: none; cursor: pointer; display: inline-flex; align-items: center; gap: 10px; }
        .conditional-question { display: none; margin-top: 25px; padding: 20px; background: var(--glass-bg); border-radius: 20px; border-left: 5px solid var(--accent-orange); backdrop-filter: blur(12px); }
        .community-feedback { padding: 60px; background: var(--glass-bg); border-top: 4px solid var(--accent-orange); backdrop-filter: blur(12px); }
        .comment-carousel { position: relative; overflow: hidden; width: 100%; }
        .comment-wrapper { display: flex; transition: transform 0.5s ease; }
        .comment { flex: 0 0 100%; margin-bottom: 30px; padding: 25px; border-left: 5px solid var(--accent-orange); background: var(--glass-bg); border-radius: 20px; box-shadow: var(--card-shadow); transition: transform 0.4s ease; display: flex; align-items: center; gap: 15px; }
        .comment:hover { transform: translateX(10px) scale(1.02); }
        .comment img { width: 40px; height: 40px; border-radius: 50%; object-fit: cover; border: 2px solid var(--glass-border); -webkit-mask-image: linear-gradient(to right, black 50%, white 50%); mask-image: linear-gradient(to right, black 50%, white 50%); }
        .comment p { font-weight: 500; font-size: 1rem; color: var(--dark); flex: 1; line-height: 1.4; }
        .share-buttons { display: flex; gap: 15px; justify-content: center; margin-top: 20px; }
        .share-btn { background: var(--accent-gradient); color: var(--lighter); padding: 10px; border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; transition: var(--transition); }
        .share-btn:hover { transform: scale(1.2); background: var(--primary-dark); }
        @keyframes progressFill { from { width: 0; } to { width: 100%; } }
        @keyframes pulseButton { 0% { transform: scale(1.03); } 50% { transform: scale(1.06); } 100% { transform: scale(1.03); } }
        @keyframes twinkle { 0% { transform: scale(1.1); } 50% { transform: scale(1.2); } 100% { transform: scale(1.1); } }
        @keyframes glow { 0% { box-shadow: 0 0 10px var(--accent); } 50% { box-shadow: 0 0 20px var(--accent); } 100% { box-shadow: 0 0 10px var(--accent); } }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        @keyframes slideIn { from { opacity: 0; transform: translateX(-30px); } to { opacity: 1; transform: translateX(0); } }
        @keyframes slideUp { from { transform: translateY(50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @media (max-width: 600px) { .form-container, .community-feedback { padding: 30px; } .header { padding: 30px; } .header h2 { font-size: 2.2rem; } .header p { font-size: 1.1rem; } .title-bar { font-size: 1.8rem; } .form-group h3 { font-size: 1.5rem; } .hero-slider, .image-rotator { height: 200px; } .options-container { flex-direction: column; } .submit-btn { font-size: 1.1rem; padding: 15px 30px; } .back-to-top { bottom: 15px; right: 15px; width: 50px; height: 50px; font-size: 1.3rem; } }
        .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0, 0, 0, 0); border: 0; }
    </style>
</head>
<body>
    <canvas class="particles" id="particles"></canvas>
    <div class="timer">
        <i class="fas fa-clock"></i> <span id="timeSpent">0:00</span>
    </div>
    <div class="dark-mode-toggle" onclick="toggleDarkMode()">
        <i class="fas fa-moon"></i>
    </div>
    <div class="save-indicator" id="saveIndicator">
        <i class="fas fa-check-circle"></i> Responses saved
    </div>
    <div class="container">
        <div class="title-bar">PREP Survey Form</div>
        <div class="header">
            <h2>🏠 Design Your Space with PREP</h2>
            <p>Help us shape the future of space modification with your feedback!</p>
            <div class="progress-container">
                <div class="progress-bar" id="progressBar"></div>
                <span class="progress-text" id="progressText">0%</span>
            </div>
        </div>
        <div class="hero-slider">
            <img src="https://images.unsplash.com/photo-1600585154340-be6161a56a0c?q=80&w=800&auto=format&fit=crop" alt="Exciting 3D room design" loading="lazy" class="active">
            <img src="https://images.unsplash.com/photo-1616486029423-aaa4789e8c9a?q=80&w=800&auto=format&fit=crop" alt="Real-time budget tracking" loading="lazy">
            <img src="https://images.unsplash.com/photo-1600585154526-990dced4db0d?q=80&w=800&auto=format&fit=crop" alt="Connecting with pros" loading="lazy">
            <img src="https://images.unsplash.com/photo-1572916115207-7038c9f8d25c?q=80&w=800&auto=format&fit=crop" alt="Collaborative design" loading="lazy">
            <img src="https://images.unsplash.com/photo-1600566753086-00f18fb6b3ea?q=80&w=800&auto=format&fit=crop" alt="Transformed living space" loading="lazy">
        </div>
        <div class="form-container">
            <form id="surveyForm" action="https://formspree.io/f/xandvned" method="POST">
                <input type="hidden" name="_cc" value="imamadam333@gmail.com">
                <div class="form-group blue" id="q1">
                    <h3>1. How excited are you to modify your space in 3D? <span class="tooltip">Visualize your dream space!</span></h3>
                    <div class="image-rotator">
                        <img src="https://images.unsplash.com/photo-1600585154340-be6161a56a0c?q=80&w=800&auto=format&fit=crop" alt="3D room excitement" loading="lazy" class="active">
                        <img src="https://images.unsplash.com/photo-1616486029423-aaa4789e8c9a?q=80&w=800&auto=format&fit=crop" alt="Interactive 3D tool" loading="lazy">
                        <img src="https://images.unsplash.com/photo-1573164713714-d95e436ab8d6?q=80&w=800&auto=format&fit=crop" alt="Custom design preview" loading="lazy">
                    </div>
                    <div class="options-container" role="radiogroup" aria-labelledby="q1-label">
                        <h3 id="q1-label" class="sr-only">How excited are you to modify your space in 3D?</h3>
                        <button type="button" class="option-btn" onclick="selectOption(this, 'modifyExcited')" role="radio" aria-checked="false" data-value="Pumped! 🚀">Pumped! 🚀</button>
                        <button type="button" class="option-btn" onclick="selectOption(this, 'modifyExcited')" role="radio" aria-checked="false" data-value="Curious 😊">Curious 😊</button>
                        <button type="button" class="option-btn" onclick="selectOption(this, 'modifyExcited')" role="radio" aria-checked="false" data-value="Not my thing 😐">Not my thing 😐</button>
                    </div>
                    <input type="hidden" name="modifyExcited" id="modifyExcited">
                </div>
                <div class="form-group orange" id="q2">
                    <h3>2. How frustrating is it when the furniture you buy doesn’t fit as expected? <span class="tooltip">Help us solve this!</span></h3>
                    <div class="image-rotator">
                        <img src="https://images.unsplash.com/photo-1554224155-6726b3ff858f?q=80&w=800&auto=format&fit=crop" alt="Furniture misfit" loading="lazy" class="active">
                        <img src="https://images.unsplash.com/photo-1597226016386-3c059d911645?q=80&w=800&auto=format&fit=crop" alt="Overcrowded room" loading="lazy">
                        <img src="https://images.unsplash.com/photo-1600585154340-be6161a56a0c?q=80&w=800&auto=format&fit=crop" alt="Design mismatch" loading="lazy">
                    </div>
                    <div class="star-rating">
                        <span class="star" onclick="rateFrustration(1)" aria-label="1 star" tabindex="0" onkeydown="handleStarKeydown(event, 1, 'rateFrustration')">★</span>
                        <span class="star" onclick="rateFrustration(2)" aria-label="2 stars" tabindex="0" onkeydown="handleStarKeydown(event, 2, 'rateFrustration')">★</span>
                        <span class="star" onclick="rateFrustration(3)" aria-label="3 stars" tabindex="0" onkeydown="handleStarKeydown(event, 3, 'rateFrustration')">★</span>
                        <span class="star" onclick="rateFrustration(4)" aria-label="4 stars" tabindex="0" onkeydown="handleStarKeydown(event, 4, 'rateFrustration')">★</span>
                        <span class="star" onclick="rateFrustration(5)" aria-label="5 stars" tabindex="0" onkeydown="handleStarKeydown(event, 5, 'rateFrustration')">★</span>
                    </div>
                    <input type="hidden" name="frustration" id="frustration">
                    <div class="conditional-question" id="frustrationFeedback">
                        <p id="frustrationMessage">We're sorry you're frustrated. What bothers you? Please share your experience.</p>
                        <textarea placeholder="Share your experience..." name="frustrationFeedback" aria-label="Frustration Feedback" oninput="debouncedSaveProgress()"></textarea>
                        <a href="https://wa.me/2348133318830" class="cta-button"><i class="fas fa-comment"></i> Chat with us!</a>
                    </div>
                </div>
                <div class="form-group blue" id="q3">
                    <h3>3. How appealing is an interactive 3D room design tool? <span class="tooltip">Imagine designing in 3D!</span></h3>
                    <div class="image-rotator">
                        <img src="https://images.unsplash.com/photo-1616486029423-aaa4789e8c9a?q=80&w=800&auto=format&fit=crop" alt="3D design tool" loading="lazy" class="active">
                        <img src="https://images.unsplash.com/photo-1540638349517-3abd5afc5847?q=80&w=800&auto=format&fit=crop" alt="Interactive layout" loading="lazy">
                        <img src="https://images.unsplash.com/photo-1586023492125-27b2c045efd7?q=80&w=800&auto=format&fit=crop" alt="Room visualization" loading="lazy">
                    </div>
                    <div class="star-rating">
                        <span class="star" onclick="rateAppeal(1)" aria-label="1 star" tabindex="0" onkeydown="handleStarKeydown(event, 1, 'rateAppeal')">★</span>
                        <span class="star" onclick="rateAppeal(2)" aria-label="2 stars" tabindex="0" onkeydown="handleStarKeydown(event, 2, 'rateAppeal')">★</span>
                        <span class="star" onclick="rateAppeal(3)" aria-label="3 stars" tabindex="0" onkeydown="handleStarKeydown(event, 3, 'rateAppeal')">★</span>
                        <span class="star" onclick="rateAppeal(4)" aria-label="4 stars" tabindex="0" onkeydown="handleStarKeydown(event, 4, 'rateAppeal')">★</span>
                        <span class="star" onclick="rateAppeal(5)" aria-label="5 stars" tabindex="0" onkeydown="handleStarKeydown(event, 5, 'rateAppeal')">★</span>
                    </div>
                    <input type="hidden" name="appeal" id="appeal">
                </div>
                <div class="form-group orange" id="q4">
                    <h3>4. How would you prefer to input your room’s information to create the 3D model? <span class="tooltip">Choose your easiest method!</span></h3>
                    <div class="image-rotator">
                        <img src="https://images.unsplash.com/photo-1600585154340-be6161a56a0c?q=80&w=800&auto=format&fit=crop" alt="Room scanning" loading="lazy" class="active">
                        <img src="https://images.unsplash.com/photo-1616486029423-aaa4789e8c9a?q=80&w=800&auto=format&fit=crop" alt="Floor plan upload" loading="lazy">
                        <img src="https://images.unsplash.com/photo-1620626011761-9963174c7c4f?q=80&w=800&auto=format&fit=crop" alt="Phone measurement" loading="lazy">
                    </div>
                    <div class="options-container" role="radiogroup" aria-labelledby="q4-label">
                        <h3 id="q4-label" class="sr-only">How would you prefer to input your room's information to create the 3D model?</h3>
                        <button type="button" class="option-btn" onclick="selectOption(this, 'inputMethod')" role="radio" aria-checked="false" data-value="Manually entering room dimensions">Manually enter dimensions</button>
                        <button type="button" class="option-btn" onclick="selectOption(this, 'inputMethod')" role="radio" aria-checked="false" data-value="Uploading an existing 2D floor plan">Upload 2D floor plan</button>
                        <button type="button" class="option-btn" onclick="selectOption(this, 'inputMethod')" role="radio" aria-checked="false" data-value="Taking photos with my phone for analysis">Take photos with phone</button>
                        <button type="button" class="option-btn" onclick="selectOption(this, 'inputMethod')" role="radio" aria-checked="false" data-value="Using a phone's sensor to scan the room">Use phone sensor to scan</button>
                    </div>
                    <input type="hidden" name="inputMethod" id="inputMethod">
                </div>
                <div class="form-group blue" id="q5">
                    <h3>5. How important is it for you to connect with local professionals (like builders or designers)? <span class="tooltip">Connect with pros easily!</span></h3>
                    <div class="image-rotator">
                        <img src="https://images.unsplash.com/photo-1600585154526-990dced4db0d?q=80&w=800&auto=format&fit=crop" alt="Builder meeting" loading="lazy" class="active">
                        <img src="https://images.unsplash.com/photo-1562322140-8baeececf3df?q=80&w=800&auto=format&fit=crop" alt="Designer consultation" loading="lazy">
                        <img src="https://images.unsplash.com/photo-1600880292203-757bb62b4baf?q=80&w=800&auto=format&fit=crop" alt="Team collaboration" loading="lazy">
                    </div>
                    <div class="star-rating">
                        <span class="star" onclick="rateImportance(1)" aria-label="1 star" tabindex="0" onkeydown="handleStarKeydown(event, 1, 'rateImportance')">★</span>
                        <span class="star" onclick="rateImportance(2)" aria-label="2 stars" tabindex="0" onkeydown="handleStarKeydown(event, 2, 'rateImportance')">★</span>
                        <span class="star" onclick="rateImportance(3)" aria-label="3 stars" tabindex="0" onkeydown="handleStarKeydown(event, 3, 'rateImportance')">★</span>
                        <span class="star" onclick="rateImportance(4)" aria-label="4 stars" tabindex="0" onkeydown="handleStarKeydown(event, 4, 'rateImportance')">★</span>
                        <span class="star" onclick="rateImportance(5)" aria-label="5 stars" tabindex="0" onkeydown="handleStarKeydown(event, 5, 'rateImportance')">★</span>
                    </div>
                    <input type="hidden" name="importance" id="importance">
                </div>
                <div class="form-group orange" id="q6">
                    <h3>6. Do you enjoy picking details like colors, furniture, or materials for space modifications? <span class="tooltip">Love designing or find it tedious?</span></h3>
                    <div class="image-rotator">
                        <img src="https://images.unsplash.com/photo-1600210492486-724fe5c67fb0?q=80&w=800&auto=format&fit=crop" alt="Color selection" loading="lazy" class="active">
                        <img src="https://images.unsplash.com/photo-1493663284031-b7e3aaa4c4b1?q=80&w=800&auto=format&fit=crop" alt="Furniture choice" loading="lazy">
                        <img src="https://images.unsplash.com/photo-1541140532154-b024d705b90a?q=80&w=800&auto=format&fit=crop" alt="Material options" loading="lazy">
                    </div>
                    <div class="options-container" role="radiogroup" aria-labelledby="q6-label">
                        <h3 id="q6-label" class="sr-only">Do you enjoy picking details like colors, furniture, or materials for space modifications?</h3>
                        <button type="button" class="option-btn" onclick="selectOption(this, 'detailsEnjoy')" role="radio" aria-checked="false" data-value="Love it! 😍">Love it! 😍</button>
                        <button type="button" class="option-btn" onclick="selectOption(this, 'detailsEnjoy')" role="radio" aria-checked="false" data-value="It's okay 😊">It's okay 😊</button>
                        <button type="button" class="option-btn" onclick="selectOption(this, 'detailsEnjoy')" role="radio" aria-checked="false" data-value="Too tedious 😓">Too tedious 😓</button>
                    </div>
                    <input type="hidden" name="detailsEnjoy" id="detailsEnjoy">
                </div>
                <div class="form-group blue" id="q7">
                    <h3>7. How much would you rely on AI for modifications? <span class="tooltip">Let AI spark your creativity!</span></h3>
                    <div class="image-rotator">
                        <img src="https://images.unsplash.com/photo-1620626011761-9963174c7c4f?q=80&w=800&auto=format&fit=crop" alt="AI design suggestion" loading="lazy" class="active">
                        <img src="https://images.unsplash.com/photo-1518709268805-4e9042af2176?q=80&w=800&auto=format&fit=crop" alt="Smart layout" loading="lazy">
                        <img src="https://images.unsplash.com/photo-1573164713714-d95e436ab8d6?q=80&w=800&auto=format&fit=crop" alt="AI optimization" loading="lazy">
                    </div>
                    <div class="star-rating">
                        <span class="star" onclick="rateAIReliance(1)" aria-label="1 star" tabindex="0" onkeydown="handleStarKeydown(event, 1, 'rateAIReliance')">★</span>
                        <span class="star" onclick="rateAIReliance(2)" aria-label="2 stars" tabindex="0" onkeydown="handleStarKeydown(event, 2, 'rateAIReliance')">★</span>
                        <span class="star" onclick="rateAIReliance(3)" aria-label="3 stars" tabindex="0" onkeydown="handleStarKeydown(event, 3, 'rateAIReliance')">★</span>
                        <span class="star" onclick="rateAIReliance(4)" aria-label="4 stars" tabindex="0" onkeydown="handleStarKeydown(event, 4, 'rateAIReliance')">★</span>
                        <span class="star" onclick="rateAIReliance(5)" aria-label="5 stars" tabindex="0" onkeydown="handleStarKeydown(event, 5, 'rateAIReliance')">★</span>
                    </div>
                    <input type="hidden" name="autoDesign" id="autoDesign">
                    <div class="conditional-question" id="lowRatingFeedback">
                        <p>How can we improve AI suggestions?</p>
                        <textarea placeholder="Share your thoughts..." name="lowRating" aria-label="Low Rating Feedback" oninput="debouncedSaveProgress()"></textarea>
                        <a href="https://wa.me/2348133318830" class="cta-button"><i class="fas fa-comment"></i> Chat with us!</a>
                    </div>
                </div>
                <div class="form-group orange" id="q8">
                    <h3>8. How important is seeing real-time cost updates as you modify your space? <span class="tooltip">Stay on budget!</span></h3>
                    <div class="image-rotator">
                        <img src="https://images.unsplash.com/photo-1450101499163-c8848c66ca85?q=80&w=800&auto=format&fit=crop" alt="Cost tracking" loading="lazy" class="active">
                        <img src="https://images.unsplash.com/photo-1558618047-3c8c76ca7d13?q=80&w=800&auto=format&fit=crop" alt="Budget overview" loading="lazy">
                        <img src="https://images.unsplash.com/photo-1581091226825-a6a2a5aee158?q=80&w=800&auto=format&fit=crop" alt="Expense calculator" loading="lazy">
                    </div>
                    <div class="options-container" role="radiogroup" aria-labelledby="q8-label">
                        <h3 id="q8-label" class="sr-only">How important is seeing real-time cost updates as you modify your space?</h3>
                        <button type="button" class="option-btn" onclick="selectOption(this, 'costs')" role="radio" aria-checked="false" data-value="Must-have 💰">Must-have 💰</button>
                        <button type="button" class="option-btn" onclick="selectOption(this, 'costs')" role="radio" aria-checked="false" data-value="Nice to have 😊">Nice to have 😊</button>
                        <button type="button" class="option-btn" onclick="selectOption(this, 'costs')" role="radio" aria-checked="false" data-value="Don't care 🤷">Don't care 🤷</button>
                    </div>
                    <input type="hidden" name="costs" id="costs">
                </div>
                <div class="form-group blue" id="q9">
                    <h3>9. How easy should uploading a photo/floor plan be? <span class="tooltip">Simplify your start!</span></h3>
                    <div class="image-rotator">
                        <img src="https://images.unsplash.com/photo-1616587226157-48e49175ee20?q=80&w=800&auto=format&fit=crop" alt="Easy upload" loading="lazy" class="active">
                        <img src="https://images.unsplash.com/photo-1579530190414-b752c5dd70b3?q=80&w=800&auto=format&fit=crop" alt="Drag and drop" loading="lazy">
                        <img src="https://images.unsplash.com/photo-1616486338815-1e6b4d4e8392?q=80&w=800&auto=format&fit=crop" alt="Quick upload" loading="lazy">
                    </div>
                    <div class="options-container" role="radiogroup" aria-labelledby="q9-label">
                        <h3 id="q9-label" class="sr-only">How easy should uploading a photo or floor plan be to start modifying your space?</h3>
                        <button type="button" class="option-btn" onclick="selectOption(this, 'uploadEase')" role="radio" aria-checked="false" data-value="1-click simple 🚀">1-click simple 🚀</button>
                        <button type="button" class="option-btn" onclick="selectOption(this, 'uploadEase')" role="radio" aria-checked="false" data-value="A few steps is fine 📋">A few steps is fine 📋</button>
                        <button type="button" class="option-btn" onclick="selectOption(this, 'uploadEase')" role="radio" aria-checked="false" data-value="Not a big deal 🤷">Not a big deal 🤷</button>
                    </div>
                    <input type="hidden" name="uploadEase" id="uploadEase">
                </div>
                <div class="form-group orange" id="q10">
                    <h3>10. Would you want to save and revisit your designs later? <span class="tooltip">Keep your ideas safe!</span></h3>
                    <div class="image-rotator">
                        <img src="https://images.unsplash.com/photo-1579202673506-ca846ce2e1bb?q=80&w=800&auto=format&fit=crop" alt="Design library" loading="lazy" class="active">
                        <img src="https://images.unsplash.com/photo-1616627563236-18bccb9a032a?q=80&w=800&auto=format&fit=crop" alt="Saved projects" loading="lazy">
                        <img src="https://images.unsplash.com/photo-1581291518633-83b4ebd1d83e?q=80&w=800&auto=format&fit=crop" alt="Project history" loading="lazy">
                    </div>
                    <div class="options-container" role="radiogroup" aria-labelledby="q10-label">
                        <h3 id="q10-label" class="sr-only">Would you want to save and revisit your designs later?</h3>
                        <button type="button" class="option-btn" onclick="selectOption(this, 'saveRevisit')" role="radio" aria-checked="false" data-value="Definitely! 💾">Definitely! 💾</button>
                        <button type="button" class="option-btn" onclick="selectOption(this, 'saveRevisit')" role="radio" aria-checked="false" data-value="Maybe sometimes 😊">Maybe sometimes 😊</button>
                        <button type="button" class="option-btn" onclick="selectOption(this, 'saveRevisit')" role="radio" aria-checked="false" data-value="Not needed 🙅">Not needed 🙅</button>
                    </div>
                    <input type="hidden" name="saveRevisit" id="saveRevisit">
                </div>
                <div class="form-group blue" id="q11">
                    <h3>11. How often would you share your 3D designs? <span class="tooltip">Collaborate easily!</span></h3>
                    <div class="image-rotator">
                        <img src="https://images.unsplash.com/photo-1572916115207-7038c9f8d25c?q=80&w=800&auto=format&fit=crop" alt="Design sharing" loading="lazy" class="active">
                        <img src="https://images.unsplash.com/photo-1579389083078-4e7018379f7e?q=80&w=800&auto=format&fit=crop" alt="Team review" loading="lazy">
                        <img src="https://images.unsplash.com/photo-1600585154340-be6161a56a0c?q=80&w=800&auto=format&fit=crop" alt="Export design" loading="lazy">
                    </div>
                    <div class="options-container" role="radiogroup" aria-labelledby="q11-label">
                        <h3 id="q11-label" class="sr-only">How often would you share your 3D modification designs with others (e.g., family, builders)?</h3>
                        <button type="button" class="option-btn" onclick="selectOption(this, 'shareDesigns')" role="radio" aria-checked="false" data-value="All the time! 📤">All the time! 📤</button>
                        <button type="button" class="option-btn" onclick="selectOption(this, 'shareDesigns')" role="radio" aria-checked="false" data-value="Occasionally 😊">Occasionally 😊</button>
                        <button type="button" class="option-btn" onclick="selectOption(this, 'shareDesigns')" role="radio" aria-checked="false" data-value="Rarely/Never 🙅">Rarely/Never 🙅</button>
                    </div>
                    <input type="hidden" name="shareDesigns" id="shareDesigns">
                </div>
                <div class="form-group orange" id="q12">
                    <h3>12. Would you be comfortable specifying room or space dimensions (height, width) for better cost estimates? <span class="tooltip">Accurate costs matter!</span></h3>
                    <div class="image-rotator">
                        <img src="https://images.unsplash.com/photo-1581091226825-a6a2a5aee158?q=80&w=800&auto=format&fit=crop" alt="Room measurement" loading="lazy" class="active">
                        <img src="https://images.unsplash.com/photo-1581092918056-0c4c3acd3789?q=80&w=800&auto=format&fit=crop" alt="Dimension input" loading="lazy">
                        <img src="https://images.unsplash.com/photo-1600585154340-be6161a56a0c?q=80&w=800&auto=format&fit=crop" alt="Precision sizing" loading="lazy">
                    </div>
                    <div class="options-container" role="radiogroup" aria-labelledby="q12-label">
                        <h3 id="q12-label" class="sr-only">Would you be comfortable specifying room or space dimensions (height, width) for better cost estimates?</h3>
                        <button type="button" class="option-btn" onclick="selectOption(this, 'dimensionsComfort')" role="radio" aria-checked="false" data-value="Totally fine 📏">Totally fine 📏</button>
                        <button type="button" class="option-btn" onclick="selectOption(this, 'dimensionsComfort')" role="radio" aria-checked="false" data-value="A bit annoying 😕">A bit annoying 😕</button>
                        <button type="button" class="option-btn" onclick="selectOption(this, 'dimensionsComfort')" role="radio" aria-checked="false" data-value="No way, too hard 🙅">No way, too hard 🙅</button>
                    </div>
                    <input type="hidden" name="dimensionsComfort" id="dimensionsComfort">
                </div>
                <div class="form-group blue" id="q13">
                    <h3>13. Biggest hassle when modifying a space? <span class="tooltip">Tell us your pain points!</span></h3>
                    <div class="image-rotator">
                        <img src="https://images.unsplash.com/photo-1597226016386-3c059d911645?q=80&w=800&auto=format&fit=crop" alt="Renovation challenge" loading="lazy" class="active">
                        <img src="https://images.unsplash.com/photo-1558618047-3c8c76ca7d13?q=80&w=800&auto=format&fit=crop" alt="Contractor delay" loading="lazy">
                        <img src="https://images.unsplash.com/photo-1600585154340-be6161a56a0c?q=80&w=800&auto=format&fit=crop" alt="Design issue" loading="lazy">
                    </div>
                    <textarea placeholder="Share your thoughts..." name="hassle" aria-label="Hassle" oninput="debouncedSaveProgress()"></textarea>
                </div>
                <div class="form-group orange" id="q14">
                    <h3>14. Any other thoughts on home design? <span class="tooltip">Your ideas shape PREP!</span></h3>
                    <div class="image-rotator">
                        <img src="https://images.unsplash.com/photo-1560448204-603b3fc33ddc?q=80&w=800&auto=format&fit=crop" alt="Design feedback" loading="lazy" class="active">
                        <img src="https://images.unsplash.com/photo-1516387938699-a93567ec168e?q=80&w=800&auto=format&fit=crop" alt="Creative input" loading="lazy">
                        <img src="https://images.unsplash.com/photo-1542435503-956c469947f6?q=80&w=800&auto=format&fit=crop" alt="User ideas" loading="lazy">
                    </div>
                    <textarea placeholder="Share any additional thoughts..." name="comments" aria-label="Comments" oninput="debouncedSaveProgress()"></textarea>
                </div>
                <div class="form-group blue" id="q15">
                    <h3>15. Which PREP feature excites you the most? <span class="tooltip">Tell us what you love!</span></h3>
                    <div class="image-rotator">
                        <img src="https://images.unsplash.com/photo-1620626011761-9963174c7c4f?q=80&w=800&auto=format&fit=crop" alt="3D design tool" loading="lazy" class="active">
                        <img src="https://images.unsplash.com/photo-1450101499163-c8848c66ca85?q=80&w=800&auto=format&fit=crop" alt="Real-time costs" loading="lazy">
                        <img src="https://images.unsplash.com/photo-1600585154526-990dced4db0d?q=80&w=800&auto=format&fit=crop" alt="Pro connections" loading="lazy">
                        <img src="https://images.unsplash.com/photo-1518709268805-4e9042af2176?q=80&w=800&auto=format&fit=crop" alt="AI suggestions" loading="lazy">
                    </div>
                    <div class="options-container" role="radiogroup" aria-labelledby="q15-label">
                        <h3 id="q15-label" class="sr-only">Which PREP feature excites you the most?</h3>
                        <button type="button" class="option-btn" onclick="selectOption(this, 'favoriteFeature')" role="radio" aria-checked="false" data-value="3D Design Tool">3D Design Tool</button>
                        <button type="button" class="option-btn" onclick="selectOption(this, 'favoriteFeature')" role="radio" aria-checked="false" data-value="Real-Time Cost Updates">Real-Time Cost Updates</button>
                        <button type="button" class="option-btn" onclick="selectOption(this, 'favoriteFeature')" role="radio" aria-checked="false" data-value="Connecting with Professionals">Connecting with Professionals</button>
                        <button type="button" class="option-btn" onclick="selectOption(this, 'favoriteFeature')" role="radio" aria-checked="false" data-value="AI Design Suggestions">AI Design Suggestions</button>
                    </div>
                    <input type="hidden" name="favoriteFeature" id="favoriteFeature">
                </div>
                <div class="form-group orange" id="q16">
                    <h3>16. Interested in being a beta tester? <span class="tooltip">Join our beta testers!</span></h3>
                    <div class="image-rotator">
                        <img src="https://images.unsplash.com/photo-1533750349088-cd871a92f312?q=80&w=800&auto=format&fit=crop" alt="Beta testing" loading="lazy" class="active">
                        <img src="https://images.unsplash.com/photo-1579389083078-4e7018379f7e?q=80&w=800&auto=format&fit=crop" alt="Early access" loading="lazy">
                        <img src="https://images.unsplash.com/photo-1516387938699-a93567ec168e?q=80&w=800&auto=format&fit=crop" alt="User testing" loading="lazy">
                    </div>
                    <input type="email" placeholder="Your email (optional)" name="email" aria-label="Email" oninput="debouncedSaveProgress()">
                </div>
                <div class="form-group blue" id="q17">
                    <h3>17. Please tell us your name <span class="tooltip">Personalize your feedback!</span></h3>
                    <div class="image-rotator">
                        <img src="https://images.unsplash.com/photo-1533750349088-cd871a92f312?q=80&w=800&auto=format&fit=crop" alt="User profile" loading="lazy" class="active">
                        <img src="https://images.unsplash.com/photo-1579389083078-4e7018379f7e?q=80&w=800&auto=format&fit=crop" alt="Personal touch" loading="lazy">
                        <img src="https://images.unsplash.com/photo-1516387938699-a93567ec168e?q=80&w=800&auto=format&fit=crop" alt="Identity share" loading="lazy">
                    </div>
                    <input type="text" placeholder="Your name (optional)" name="name" aria-label="Name" oninput="debouncedSaveProgress()">
                </div>
                <input type="hidden" name="timeSpent" id="timeSpentInput">
                <div class="submit-btn-container">
                    <button type="button" class="submit-btn" onclick="showSummary()">
                        <i class="fas fa-paper-plane"></i> Submit Feedback
                    </button>
                    <button type="button" class="submit-btn save" onclick="saveProgress()">
                        <i class="fas fa-save"></i> Save Progress
                    </button>
                    <button type="button" class="submit-btn clear" onclick="clearForm()">
                        <i class="fas fa-trash"></i> Clear Form
                    </button>
                </div>
                <p class="error-message" id="errorMessage"></p>
            </form>
        </div>
        <div class="thank-you-message" id="thankYouMessage">
            <h2>Congratulations! 🎉</h2>
            <p id="thankYouText"></p>
            <div class="share-buttons">
                <a href="https://www.facebook.com/sharer/sharer.php?u=https://tiiny.host/" target="_blank" class="share-btn"><i class="fab fa-facebook-f"></i></a>
                <a href="https://twitter.com/intent/tweet?url=https://tiiny.host/&text=Check%20out%20the%20PREP%20Survey!" target="_blank" class="share-btn"><i class="fab fa-twitter"></i></a>
                <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://tiiny.host/" target="_blank" class="share-btn"><i class="fab fa-linkedin-in"></i></a>
            </div>
            <a href="https://wa.me/2348133318830" class="cta-button"><i class="fas fa-comment"></i> Chat with us!</a>
            <button type="button" class="cta-button" onclick="editForm()"><i class="fas fa-edit"></i> Edit Responses</button>
        </div>
        <div class="community-feedback" id="communityFeedback">
            <h3>What Others Are Saying</h3>
            <div class="comment-carousel">
                <div class="comment-wrapper">
                    <div class="comment">
                        <img src="https://randomuser.me/api/portraits/men/1.jpg" alt="Abubakar avatar">
                        <div><p>Using my phone camera to scan a room for an instant 3D model would be a game-changer!</p><cite>Abubakar Abdulfatah</cite></div>
                    </div>
                    <div class="comment">
                        <img src="https://randomuser.me/api/portraits/men/2.jpg" alt="Steve avatar">
                        <div><p>Material selection needs to be simpler; too many options can feel overwhelming for new users.</p><cite>Steve Jobs</cite></div>
                    </div>
                    <div class="comment">
                        <img src="https://randomuser.me/api/portraits/women/1.jpg" alt="Stephanie avatar">
                        <div><p>Real-time cost updates are fantastic, but adding alerts for budget caps would be even better!</p><cite>Stephanie McKenzie</cite></div>
                    </div>
                    <div class="comment">
                        <img src="https://randomuser.me/api/portraits/men/3.jpg" alt="Ridwan avatar">
                        <div><p>Connecting with local builders through the platform should be as seamless as possible!</p><cite>Ridwan Kolawole</cite></div>
                    </div>
                    <div class="comment">
                        <img src="https://randomuser.me/api/portraits/men/4.jpg" alt="Umar avatar">
                        <div><p>AI suggestions are awesome, but adding voice command tweaks would make it next-level!</p><cite>Umar Matoh</cite></div>
                    </div>
                    <div class="comment">
                        <img src="https://randomuser.me/api/portraits/men/5.jpg" alt="Usman avatar">
                        <div><p>I’d love to see eco-friendly material options included in the design library for sustainability.</p><cite>Usman Attahir</cite></div>
                    </div>
                    <div class="comment">
                        <img src="https://randomuser.me/api/portraits/men/6.jpg" alt="Clement avatar">
                        <div><p>A quick-start guide for beginners would make the platform so much easier to use!</p><cite>Clement Jerry</cite></div>
                    </div>
                    <div class="comment">
                        <img src="https://randomuser.me/api/portraits/men/7.jpg" alt="Mustapha avatar">
                        <div><p>Comparing costs across multiple design options in one view would save so much time!</p><cite>Mustapha Muhammad</cite></div>
                    </div>
                    <div class="comment">
                        <img src="https://randomuser.me/api/portraits/women/2.jpg" alt="Ch
                        </div>
                    <div class="comment">
                        <img src="https://randomuser.me/api/portraits/women/2.jpg" alt="Chisom avatar">
                        <div><p>The ability to save and revisit designs with notes would be a lifesaver for planning!</p><cite>Chisom Okonkwo</cite></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="waitlist-footer" id="waitlistFooter">
            <p>Want to be the first to try PREP? <input type="email" id="waitlistEmailFooter" placeholder="Enter your email" aria-label="Waitlist Email" oninput="debouncedSaveProgress()"> <button type="button" class="cta-button" onclick="joinWaitlist('waitlistEmailFooter')"><i class="fas fa-paper-plane"></i> Join Waitlist</button></p>
        </div>
        <div class="waitlist-thank-you" id="waitlistThankYou">
            <h2>Awesome! 🎉</h2>
            <p id="waitlistThankYouText"></p>
            <button type="button" class="cta-button" onclick="backToForm()"><i class="fas fa-arrow-left"></i> Back to Survey</button>
        </div>
    </div>
    <a href="#" class="back-to-top" id="backToTop"><i class="fas fa-arrow-up"></i></a>
    <script>
        let selectedOptions = { timeSpent: '0:00' };
        let currentFrustrationRating = 0, appealRating = 0, importanceRating = 0, aiRelianceRating = 0;
        let currentCommentIndex = 0;
        let timeInterval, saveTimeout;

        function initForm() {
            loadSavedProgress();
            startTimer();
            initImageRotators();
            initCommentCarousel();
            initParticles();
            toggleDarkMode(localStorage.getItem('darkMode') === 'true');
            window.addEventListener('scroll', () => {
                document.getElementById('backToTop').classList.toggle('visible', window.scrollY > 300);
            });
            document.getElementById('frustrationFeedback').style.display = currentFrustrationRating >= 4 || currentFrustrationRating < 3 ? 'block' : 'none';
            document.getElementById('lowRatingFeedback').style.display = aiRelianceRating <= 2 ? 'block' : 'none';
            updateProgressBar();
        }

        function startTimer() {
            let time = 0;
            timeInterval = setInterval(() => {
                time++;
                const minutes = Math.floor(time / 60);
                const seconds = time % 60;
                document.getElementById('timeSpent').textContent = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
                document.getElementById('timeSpentInput').value = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
                selectedOptions.timeSpent = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
                debouncedSaveProgress();
            }, 1000);
        }

        function initImageRotators() {
            const rotators = document.querySelectorAll('.image-rotator, .hero-slider');
            const rotatorStates = Array.from(rotators).map(rotator => ({
                images: rotator.querySelectorAll('img'),
                currentIndex: 0
            }));
            rotatorStates.forEach(state => {
                if (state.images.length > 0) {
                    state.images[0].classList.add('active');
                    state.images.forEach(img => {
                        img.onerror = () => {
                            img.src = 'https://images.unsplash.com/photo-1600585154340-be6161a56a0c?q=80&w=800&auto=format&fit=crop'; // Fallback
                        };
                    });
                }
            });
            setInterval(() => {
                rotatorStates.forEach(state => {
                    if (state.images.length > 0) {
                        state.images[state.currentIndex].classList.remove('active');
                        state.currentIndex = (state.currentIndex + 1) % state.images.length;
                        state.images[state.currentIndex].classList.add('active');
                    }
                });
            }, 3000); // Rotate every 3 seconds
        }

        function initCommentCarousel() {
            const wrapper = document.querySelector('.comment-wrapper');
            const comments = document.querySelectorAll('.comment');
            if (comments.length > 0) {
                setInterval(() => {
                    currentCommentIndex = (currentCommentIndex + 1) % comments.length;
                    wrapper.style.transform = `translateX(-${currentCommentIndex * 100}%)`;
                }, 5000); // Rotate every 5 seconds
            }
        }

        function initParticles() {
            const canvas = document.getElementById('particles');
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            const particles = [];
            const particleCount = 150;

            for (let i = 0; i < particleCount; i++) {
                particles.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    size: Math.random() * 5 + 1,
                    speedX: Math.random() * 2 - 1,
                    speedY: Math.random() * 2 - 1,
                    color: `hsl(${Math.random() * 60 + 180}, 70%, ${Math.random() * 20 + 50}%)`
                });
            }

            function animateParticles() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                particles.forEach(p => {
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                    ctx.fillStyle = p.color;
                    ctx.fill();
                    p.x += p.speedX;
                    p.y += p.speedY;
                    if (p.x < 0 || p.x > canvas.width) p.speedX *= -1;
                    if (p.y < 0 || p.y > canvas.height) p.speedY *= -1;
                });
                requestAnimationFrame(animateParticles);
            }
            animateParticles();
        }

        function toggleDarkMode(force) {
            const isDark = force || document.body.classList.toggle('dark-mode');
            localStorage.setItem('darkMode', isDark);
            document.querySelector('.dark-mode-toggle i').classList.toggle('fa-moon', !isDark);
            document.querySelector('.dark-mode-toggle i').classList.toggle('fa-sun', isDark);
        }

        const debouncedSaveProgress = () => {
            clearTimeout(saveTimeout);
            saveTimeout = setTimeout(saveProgress, 500);
        };

        function saveProgress() {
            localStorage.setItem('surveyProgress', JSON.stringify(selectedOptions));
            const saveIndicator = document.getElementById('saveIndicator');
            saveIndicator.classList.add('visible');
            setTimeout(() => saveIndicator.classList.remove('visible'), 2000);
        }

        function loadSavedProgress() {
            const saved = localStorage.getItem('surveyProgress');
            if (saved) {
                const progress = JSON.parse(saved);
                Object.keys(progress).forEach(key => {
                    selectedOptions[key] = progress[key];
                    const input = document.getElementById(key);
                    if (input) input.value = progress[key];
                    if (key === 'frustration') rateFrustration(progress[key], true);
                    if (key === 'appeal') rateAppeal(progress[key], true);
                    if (key === 'importance') rateImportance(progress[key], true);
                    if (key === 'autoDesign') rateAIReliance(progress[key], true);
                    const container = document.querySelector(`[data-field="${key}"]`);
                    if (container) {
                        const buttons = container.querySelectorAll('.option-btn');
                        buttons.forEach(btn => {
                            if (btn.getAttribute('data-value') === progress[key]) {
                                selectOption(btn, key, true);
                            }
                        });
                    }
                    if (key === 'frustrationFeedback') {
                        document.querySelector('textarea[name="frustrationFeedback"]').value = progress[key];
                        if (progress.frustration >= 4 || progress.frustration < 3) {
                            document.getElementById('frustrationFeedback').style.display = 'block';
                        }
                    }
                    if (key === 'lowRating') {
                        document.querySelector('textarea[name="lowRating"]').value = progress[key];
                        if (progress.autoDesign <= 2) {
                            document.getElementById('lowRatingFeedback').style.display = 'block';
                        }
                    }
                });
                updateProgressBar();
            }
        }

        function selectOption(button, field, fromLoad = false) {
            const buttons = button.parentElement.querySelectorAll('.option-btn');
            buttons.forEach(btn => {
                btn.classList.remove('selected');
                btn.setAttribute('aria-checked', 'false');
            });
            button.classList.add('selected');
            button.setAttribute('aria-checked', 'true');
            selectedOptions[field] = button.getAttribute('data-value');
            document.getElementById(field).value = selectedOptions[field];
            if (!fromLoad) {
                debouncedSaveProgress();
                updateProgressBar();
            }
        }

        function rateFrustration(stars, fromLoad = false) {
            currentFrustrationRating = stars;
            selectedOptions.frustration = stars;
            document.getElementById('frustration').value = stars;
            const starElements = document.querySelectorAll('#q2 .star');
            starElements.forEach((star, index) => {
                star.classList.toggle('active', index < stars);
            });
            const feedback = document.getElementById('frustrationFeedback');
            feedback.style.display = stars >= 4 || stars < 3 ? 'block' : 'none';
            document.getElementById('frustrationMessage').textContent = stars < 3 ? "We're sorry you're not satisfied. What bothers you? Please share your experience." : "What bothers you? Please share your experience.";
            if (!fromLoad) {
                debouncedSaveProgress();
                updateProgressBar();
            }
        }

        function rateAppeal(stars, fromLoad = false) {
            appealRating = stars;
            selectedOptions.appeal = stars;
            document.getElementById('appeal').value = stars;
            const starElements = document.querySelectorAll('#q3 .star');
            starElements.forEach((star, index) => {
                star.classList.toggle('active', index < stars);
            });
            if (!fromLoad) {
                debouncedSaveProgress();
                updateProgressBar();
            }
        }

        function rateImportance(stars, fromLoad = false) {
            importanceRating = stars;
            selectedOptions.importance = stars;
            document.getElementById('importance').value = stars;
            const starElements = document.querySelectorAll('#q5 .star');
            starElements.forEach((star, index) => {
                star.classList.toggle('active', index < stars);
            });
            if (!fromLoad) {
                debouncedSaveProgress();
                updateProgressBar();
            }
        }

        function rateAIReliance(stars, fromLoad = false) {
            aiRelianceRating = stars;
            selectedOptions.autoDesign = stars;
            document.getElementById('autoDesign').value = stars;
            const starElements = document.querySelectorAll('#q7 .star');
            starElements.forEach((star, index) => {
                star.classList.toggle('active', index < stars);
            });
            const feedback = document.getElementById('lowRatingFeedback');
            feedback.style.display = stars <= 2 ? 'block' : 'none';
            if (!fromLoad) {
                debouncedSaveProgress();
                updateProgressBar();
            }
        }

        function handleStarKeydown(event, stars, funcName) {
            if (event.key === 'Enter' || event.key === ' ') {
                event.preventDefault();
                window[funcName](stars);
            }
        }

        function updateProgressBar() {
            const totalQuestions = 17;
            let answered = 0;
            const fields = [
                'modifyExcited', 'frustration', 'appeal', 'inputMethod', 'importance',
                'detailsEnjoy', 'autoDesign', 'costs', 'uploadEase', 'saveRevisit',
                'shareDesigns', 'dimensionsComfort', 'hassle', 'comments', 'favoriteFeature',
                'email', 'name'
            ];
            fields.forEach(field => {
                if (selectedOptions[field] && selectedOptions[field] !== '') answered++;
            });
            const progress = (answered / totalQuestions) * 100;
            document.getElementById('progressBar').style.width = `${progress}%`;
            document.getElementById('progressText').textContent = `${Math.round(progress)}%`;
        }

        function validateForm() {
            const email = document.querySelector('input[name="email"]').value;
            const name = document.querySelector('input[name="name"]').value;
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (email && !emailRegex.test(email)) {
                showError('Please enter a valid email address.');
                return false;
            }
            if (name && /\d/.test(name)) {
                showError('Name should not contain numbers.');
                return false;
            }
            return true;
        }

        function showError(message) {
            const errorMessage = document.getElementById('errorMessage');
            errorMessage.textContent = message;
            errorMessage.style.display = 'block';
            setTimeout(() => errorMessage.style.display = 'none', 5000);
        }

        function showSummary() {
            if (!validateForm()) return;
            const form = document.getElementById('surveyForm');
            const thankYouMessage = document.getElementById('thankYouMessage');
            const thankYouText = document.getElementById('thankYouText');
            const name = selectedOptions.name || 'there';
            const email = selectedOptions.email || 'you';
            thankYouText.innerHTML = `Thank you, ${name}! Your feedback is shaping the future of PREP! 🎉<br>We'll reach out to ${email} about beta testing and updates.`;
            form.style.display = 'none';
            thankYouMessage.style.display = 'block';
            document.getElementById('waitlistFooter').style.display = 'none';
            document.getElementById('communityFeedback').style.display = 'none';
            triggerConfetti();
            localStorage.removeItem('surveyProgress');
            clearInterval(timeInterval);
            submitForm();
        }

        function triggerConfetti() {
            confetti({
                particleCount: 200,
                spread: 90,
                origin: { y: 0.6 },
                colors: ['#3b82f6', '#f97316', '#1e40af', '#fdba74'],
                shapes: ['circle', 'square', 'triangle'],
                scalar: 1.2
            });
            setTimeout(() => {
                confetti({
                    particleCount: 100,
                    spread: 120,
                    origin: { y: 0.8 },
                    colors: ['#3b82f6', '#f97316']
                });
            }, 500);
        }

        function submitForm() {
            const form = document.getElementById('surveyForm');
            const formData = new FormData(form);
            const formattedData = {};
            formData.forEach((value, key) => {
                formattedData[key] = value;
            });
            const organizedOutput = `
PREP Survey Response
-------------------
1. Excitement for 3D Modification: ${formattedData.modifyExcited || 'N/A'}
2. Frustration with Furniture Fit: ${formattedData.frustration || 'N/A'}
   - Feedback (if ≥4 or <3): ${formattedData.frustrationFeedback || 'N/A'}
3. Appeal of 3D Design Tool: ${formattedData.appeal || 'N/A'}
4. Preferred Input Method: ${formattedData.inputMethod || 'N/A'}
5. Importance of Professional Connections: ${formattedData.importance || 'N/A'}
6. Enjoyment of Design Details: ${formattedData.detailsEnjoy || 'N/A'}
7. Reliance on AI: ${formattedData.autoDesign || 'N/A'}
   - Feedback (if ≤2): ${formattedData.lowRating || 'N/A'}
8. Importance of Real-Time Costs: ${formattedData.costs || 'N/A'}
9. Ease of Uploading: ${formattedData.uploadEase || 'N/A'}
10. Saving Designs: ${formattedData.saveRevisit || 'N/A'}
11. Sharing Designs: ${formattedData.shareDesigns || 'N/A'}
12. Comfort with Dimensions: ${formattedData.dimensionsComfort || 'N/A'}
13. Biggest Hassle: ${formattedData.hassle || 'N/A'}
14. Additional Thoughts: ${formattedData.comments || 'N/A'}
15. Favorite Feature: ${formattedData.favoriteFeature || 'N/A'}
16. Email: ${formattedData.email || 'N/A'}
17. Name: ${formattedData.name || 'N/A'}
Time Spent: ${formattedData.timeSpent || 'N/A'}
-------------------
`;
            formData.set('_subject', 'PREP Survey Submission');
            formData.set('message', organizedOutput);

            fetch('https://formspree.io/f/xandvned', {
                method: 'POST',
                body: formData,
                headers: {
                    'Accept': 'application/json'
                }
            })
            .then(response => {
                if (response.ok) {
                    console.log('Form submitted successfully to imamadam333@gmail.com!');
                } else {
                    showError('Submission failed. Please try again.');
                    document.getElementById('surveyForm').style.display = 'block';
                    document.getElementById('thankYouMessage').style.display = 'none';
                    document.getElementById('waitlistFooter').style.display = 'block';
                    document.getElementById('communityFeedback').style.display = 'block';
                }
            })
            .catch(() => {
                showError('Network error. Please check your connection.');
                document.getElementById('surveyForm').style.display = 'block';
                document.getElementById('thankYouMessage').style.display = 'none';
                document.getElementById('waitlistFooter').style.display = 'block';
                document.getElementById('communityFeedback').style.display = 'block';
            });
        }

        function joinWaitlist(emailInputId = 'waitlistEmailFooter') {
            const emailInput = document.getElementById(emailInputId);
            const email = emailInput.value;
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!email || !emailRegex.test(email)) {
                showError('Please enter a valid email address for the waitlist.');
                return;
            }
            const waitlistThankYou = document.getElementById('waitlistThankYou');
            const waitlistThankYouText = document.getElementById('waitlistThankYouText');
            waitlistThankYouText.innerHTML = `Awesome, you're on the PREP waitlist! 🎉<br>We'll notify ${email} first when we launch!`;
            document.getElementById('surveyForm').style.display = 'none';
            waitlistThankYou.style.display = 'block';
            document.getElementById('waitlistFooter').style.display = 'none';
            document.getElementById('communityFeedback').style.display = 'none';
            triggerConfetti();

            const waitlistData = new FormData();
            waitlistData.append('email', email);
            waitlistData.append('_subject', 'PREP Waitlist Signup');
            waitlistData.append('message', `New waitlist signup: ${email}`);
            waitlistData.append('_cc', 'imamadam333@gmail.com');
            fetch('https://formspree.io/f/xandvned', {
                method: 'POST',
                body: waitlistData,
                headers: {
                    'Accept': 'application/json'
                }
            })
            .then(response => {
                if (!response.ok) {
                    showError('Waitlist submission failed. Please try again.');
                    waitlistThankYou.style.display = 'none';
                    document.getElementById('surveyForm').style.display = 'block';
                    document.getElementById('waitlistFooter').style.display = 'block';
                    document.getElementById('communityFeedback').style.display = 'block';
                }
            })
            .catch(() => {
                showError('Network error. Please check your connection.');
                waitlistThankYou.style.display = 'none';
                document.getElementById('surveyForm').style.display = 'block';
                document.getElementById('waitlistFooter').style.display = 'block';
                document.getElementById('communityFeedback').style.display = 'block';
            });
        }

        function backToForm() {
            document.getElementById('surveyForm').style.display = 'block';
            document.getElementById('waitlistThankYou').style.display = 'none';
            document.getElementById('waitlistFooter').style.display = 'block';
            document.getElementById('communityFeedback').style.display = 'block';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function clearForm() {
            localStorage.removeItem('surveyProgress');
            document.getElementById('surveyForm').reset();
            Object.keys(selectedOptions).forEach(key => selectedOptions[key] = key === 'timeSpent' ? '0:00' : '');
            document.querySelectorAll('.option-btn').forEach(btn => {
                btn.classList.remove('selected');
                btn.setAttribute('aria-checked', 'false');
            });
            document.querySelectorAll('.star').forEach(star => star.classList.remove('active'));
            document.querySelectorAll('input[type="hidden"]').forEach(input => input.value = '');
            document.querySelectorAll('textarea').forEach(textarea => textarea.value = '');
            document.getElementById('frustrationFeedback').style.display = 'none';
            document.getElementById('lowRatingFeedback').style.display = 'none';
            updateProgressBar();
            showError('Form cleared successfully!');
        }

        function editForm() {
            document.getElementById('surveyForm').style.display = 'block';
            document.getElementById('thankYouMessage').style.display = 'none';
            document.getElementById('waitlistFooter').style.display = 'block';
            document.getElementById('communityFeedback').style.display = 'block';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function shareSurvey() {
            const shareData = {
                title: 'PREP Survey Form',
                text: 'Help shape the future of space modification with PREP! Take this quick survey.',
                url: window.location.href
            };
            if (navigator.share) {
                navigator.share(shareData).catch(err => console.error('Share failed:', err));
            } else {
                navigator.clipboard.writeText(shareData.url).then(() => {
                    showError('Survey link copied to clipboard!');
                });
            }
        }

        window.addEventListener('resize', () => {
            const canvas = document.getElementById('particles');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });

        document.addEventListener('DOMContentLoaded', initForm);
    </script>
</body>
</html>